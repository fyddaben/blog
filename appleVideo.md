# 仿苹果视频加载方案

## 前言
- 几年前，同事分享提到，苹果的加载内容里面，有很多碎片拼成的图形，当时就感觉苹果就是牛逼，现在才想明白，+_+
- 很奇怪，这么好玩的技术，我google了好几天，也没找到，所以只有自己搞了

## 苹果效果图
![qq20161007-0](https://cloud.githubusercontent.com/assets/3349863/19190141/5d918610-8cce-11e6-8f1c-32ec24c6de62.png)

## 我的效果图
![2016-10-07 17 52 20](https://cloud.githubusercontent.com/assets/3349863/19186280/22d52e5c-8cb8-11e6-9e58-c187525f5195.gif)

## 先介绍下好处

- 通过图片，模仿视频的播放，可以更加精准的控制视频的前进，或者倒退，解决现有各种浏览器下的兼容问题
- 本来希望，换为图片之后，可以加载尺寸变小一些，实际反而增大了，想想也对，视频本来就是压缩后的，你换为图片，相当于增大了
- 不过增大的尺寸，是可以接受的

## 前提是视频的尺寸，长宽必须是8的倍数

## 方案解决流程

![default](https://cloud.githubusercontent.com/assets/3349863/19190929/b4ec7614-8cd2-11e6-89aa-05f958faf114.png)

## 环境制作
- [镜像环境安装](https://github.com/fyddaben/clown/blob/master/README.md)
- [源代码地址](https://github.com/fyddaben/videoImg)

## 详细分析如下
- PS查看苹果碎片图，发现最小的单元格为8 x 8 px.
- 还原压缩代码，发现帧数的总数，为199 或者249，加上开始的一个完整图片，总共为200或者250，所以应该是1秒为25帧的播放
- 最难的还是关于图片对比的解决方案，因为要尽可能的压缩数据，把冗余数据，重复数据去除。
- 1.要符合实际速度，不能对比太慢。因为一个视频图片1400*1080，8像素的单元格就有 175 * 135=23625个，5秒的视频有120张左右图片，200多万的单元需要处理 
- 2.还要对比出，具体哪个单元格是重复，可以合并，那些是不同的。网上的图片对比，大多都是，图片的相似度百分比，根本不能找到像素级的结果
- 最终采用了，canvas的绘图，吸色。可以完美解决，图片像素级的对比，又能保证速度。
